<project
  default="mkdist-lucane"
  xmlns:j="jelly:core"
  xmlns:maven="jelly:maven">


  <goal
    name="clean-lucane"
    description="Clean lucane">
                                                                                          
    <maven:reactor
      basedir="${basedir}"
      includes="**/project.xml"
      excludes="project.xml,applications/project.xml"
      goals="clean"
      banner="Cleaning"
      ignoreFailures="false"
    />
  </goal>

  <goal 
    name="build-lucane"
    description="Build lucane and applications">

    <maven:reactor
      basedir="${basedir}"
      includes="**/project.xml"
      excludes="project.xml,applications/project.xml"
      goals="jar,jar:install"
      banner="Building"
      ignoreFailures="false"
      />
  </goal>

  <goal
    name="mkdist-lucane"
    description="Create a distribution"
    prereqs="build-lucane">
    
    <maven:reactor
      basedir="${basedir}"
      includes="**/project.xml"
      excludes="project.xml,applications/project.xml"
      goals="mkdist"
      banner="Making dist: "
      ignoreFailures="false"
    />
  </goal>

  <goal
    name="mkwinsetup-lucane"
    description="Create a windows installer"
    prereqs="mkdist-lucane">
    
    <condition property="nsis.present">
      <available file="${nsis.path}" />
    </condition>
    <fail unless="nsis.present">
    NSIS compiler not found at ${nsis.path}. Please correct the nsis.path property in project.properties and/or download NSIS from http://nsis.sourceforge.net .
    </fail>

    <mkdir dir="../winsetup"/>

    <copy file="setup/windows/src/lucane.nsi" tofile="../dist/lucane.nsi"/>
    <copy file="setup/windows/src/lucane.ico" tofile="../dist/lucane.ico"/>
    <copy file="LICENSE.txt" tofile="../dist/licence.txt"/>

    <exec dir="../dist" executable="${nsis.path}" output="../winsetup/nsis.log">
      <arg line="lucane.nsi" />
      <env key="_project_name" value="Lucane"/>
      <env key="_project_version" value="0.7.0"/>
    </exec>

    <delete file="../dist/lucane.nsi"/>
    <delete file="../dist/lucane.ico"/>
    <delete file="../dist/licence.txt"/>

    <move file="../dist/lucane-setup.exe" tofile="../winsetup/lucane-setup.exe"/>
    
  </goal>

  <goal
    name="site-lucane">

    <maven:reactor
      basedir="${basedir}"
      includes="**/project.xml"
      excludes="project.xml,applications/project.xml"
      goals="site"
      banner="Creating site: "
      ignoreFailures="false"
    />
  </goal>

</project>
